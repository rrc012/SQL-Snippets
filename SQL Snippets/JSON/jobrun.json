{  "prefix": "jobrun",  "description": "",  "body": "use msdbgoset nocount on;declare @ijeh          tinyint = 1, --indicates number of runs for a job based on the date        @istepid       tinyint, --if null, retrieves all the steps for a given job        @irunstatus    tinyint, --if null, retrieves all the statuses for a given job        @icharposition tinyint,        @dtjehdate     date,        @sjobsnamelist varchar(1000) = '|'; --enter a comma-separated list of job names        --used to hold list of sql agent job names to processif object_id('tempdb..#jobsnamelist') is not null drop table tempdb..#jobsnamelist;create table #jobsnamelist ( job_name varchar(128), run_date date);--process listset @sjobsnamelist = @sjobsnamelist + ',';while charindex(',', @sjobsnamelist) &gt; 0begin	set @icharposition = charindex(',', @sjobsnamelist)	insert into #jobsnamelist (job_name)	select ltrim(rtrim(left(@sjobsnamelist, @icharposition - 1)));	set @sjobsnamelist = stuff(@sjobsnamelist, 1, @icharposition, '');end  -- while loop;with jehas(select j.name as job_name,       row_number() over(partition by j.name order by j.name, ca.run_date desc) as [nrun(s)],       ca.run_date  from dbo.sysjobhistory as h       inner join dbo.sysjobs as j on h.job_id = j.job_id       inner join #jobsnamelist as jnl on j.name = jnl.job_name       cross apply (select cast(convert(varchar(10), h.run_date, 101) as date) as run_date) ca group by j.name, ca.run_date),lastrunas(select jeh.job_name, min(jeh.run_date) as earliest_run_date  from jeh where [nrun(s)] = iif(@ijeh &gt; [nrun(s)], [nrun(s)], @ijeh) group by jeh.job_name)update jnl   set run_date = earliest_run_date  from lastrun as lr       inner join #jobsnamelist as jnl on lr.job_name = jnl.job_name--select * from #jobsnamelist;select j.name as jobname,       --j.description as jobdescription,       h.step_id as stepid,       h.step_name as stepname,       js.subsystem,       sd.startdate,       stuff(stuff(right('000000' + cast (h.run_time as varchar(6)),6),5,0,':'),3,0,':') starttime,       try_convert(time(0), str(floor(h.run_duration / 10000), 2, 0)                          + ':' + right(str(floor(h.run_duration / 100), 6, 0), 2)                          + ':' + right(str(h.run_duration), 2)) as [executiontime (hh:mm:ss)],       case h.run_status            when 0 then 'failed'            when 1 then 'succeeded'            when 2 then 'retry'            when 3 then 'cancelled'            when 4 then 'in progress'       end as executionstatus,       js.command,       js.database_name,       js.output_file_name,       h.message messagegenerated  from dbo.sysjobhistory as h       inner join dbo.sysjobs as j on h.job_id = j.job_id       inner join dbo.sysjobsteps as js on j.job_id = js.job_id              and h.step_id = js.step_id       inner join #jobsnamelist as jnl on j.name = jnl.job_name	  cross apply (select try_cast(str(h.run_date,8, 0) as date) as startdate) as sd where 1 = 1   and h.step_id = coalesce(@istepid, h.step_id)   and h.run_status = coalesce(@irunstatus, h.run_status)   and sd.startdate &gt;= jnl.run_date order by jobname, sd.startdate desc, starttime desc, stepid;"  <cursorpositionmarker>|</cursorpositionmarker>}